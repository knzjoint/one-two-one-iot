(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-835ac8aa"],{"1fff":function(e,t,c){"use strict";c("d4ef")},2:function(e,t){},3:function(e,t){},4:function(e,t){},"4d57":function(e,t,c){"use strict";c.r(t);var n=c("434f"),o={class:"mqtt-container"},r=Object(n["createTextVNode"])(" 断开连接 "),i=Object(n["createTextVNode"])(Object(n["toDisplayString"])("订阅")),a={href:"https://www.antdv.com/"},u=Object(n["createTextVNode"])("取消"),l=Object(n["createTextVNode"])(" 发布 ");function s(e,t,c,s,b,d){var p=Object(n["resolveComponent"])("a-input"),f=Object(n["resolveComponent"])("a-form-item"),j=Object(n["resolveComponent"])("a-col"),O=Object(n["resolveComponent"])("a-button"),h=Object(n["resolveComponent"])("a-row"),m=Object(n["resolveComponent"])("a-form"),C=Object(n["resolveComponent"])("a-card"),w=Object(n["resolveComponent"])("a-select-option"),v=Object(n["resolveComponent"])("a-select"),N=Object(n["resolveComponent"])("a-avatar"),V=Object(n["resolveComponent"])("a-list-item-meta"),x=Object(n["resolveComponent"])("a-list-item"),g=Object(n["resolveComponent"])("a-list"),_=Object(n["resolveComponent"])("a-textarea");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",o,[Object(n["createVNode"])(C,{title:"配置",shadow:"always",style:{"margin-bottom":"30px"}},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(m,{ref:"configForm",form:c.connectionMess},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(h,{gutter:20},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{name:"host",label:"主机"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.connectionMess.host,"onUpdate:value":t[0]||(t[0]=function(e){return c.connectionMess.host=e})},null,8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"端口"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.connectionMess.port,"onUpdate:value":t[1]||(t[1]=function(e){return c.connectionMess.port=e}),type:"number",placeholder:"8083/8084"},null,8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"Path"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.connectionMess.endpoint,"onUpdate:value":t[2]||(t[2]=function(e){return c.connectionMess.endpoint=e}),placeholder:"/mqtt"},null,8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"客户端ID"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.connectionMess.clientId,"onUpdate:value":t[3]||(t[3]=function(e){return c.connectionMess.clientId=e})},null,8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"用户名"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.connectionMess.username,"onUpdate:value":t[4]||(t[4]=function(e){return c.connectionMess.username=e})},null,8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"密码"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.connectionMess.password,"onUpdate:value":t[5]||(t[5]=function(e){return c.connectionMess.password=e})},null,8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:24},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(O,{type:"primary",size:"small",class:"conn-btn",style:{"margin-right":"20px"},loading:b.connectedLoading,disabled:b.connected,onClick:d.createConnection},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(b.connected?"断开":"连接"),1)]})),_:1},8,["loading","disabled","onClick"]),b.connected?(Object(n["openBlock"])(),Object(n["createBlock"])(O,{key:0,type:"danger",size:"small",class:"conn-btn",onClick:d.destroyConnection},{default:Object(n["withCtx"])((function(){return[r]})),_:1},8,["onClick"])):Object(n["createCommentVNode"])("",!0)]})),_:1})]})),_:1})]})),_:1},8,["form"])]})),_:1}),Object(n["createVNode"])(C,{title:"订阅",shadow:"always",style:{"margin-bottom":"30px"}},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(m,{ref:"subscription","hide-required-asterisk":"",size:"small","label-position":"top",form:c.subscription},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(h,{gutter:20},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{span:16},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"主题"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.subscription.topic,"onUpdate:value":t[6]||(t[6]=function(e){return c.subscription.topic=e})},null,8,["value"])]})),_:1})]})),_:1})]})),_:1}),Object(n["createVNode"])(h,{gutter:20},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"QoS"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(v,{value:c.subscription.qos,placeholder:"请选择qos"},{default:Object(n["withCtx"])((function(){return[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(b.qosList,(function(e,t){return Object(n["openBlock"])(),Object(n["createBlock"])(w,{key:e.vlue,value:e.value},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.label),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:5}),Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(O,{disabled:!b.connected,type:"primary",size:"small",class:"subscribe-btn",onClick:d.doSubscribe},{default:Object(n["withCtx"])((function(){return[i]})),_:1},8,["disabled","onClick"])]})),_:1})]})),_:1})]})),_:1},8,["form"]),Object(n["createVNode"])(h,null,{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{span:20},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(g,{"item-layout":"horizontal","data-source":b.subscripTopics},{renderItem:Object(n["withCtx"])((function(e){var t=e.item;return[Object(n["createVNode"])(x,null,{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(V,{description:t.topic},{title:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("a",a,Object(n["toDisplayString"])(t.title),1)]})),avatar:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(N,{src:"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png"})]})),_:2},1032,["description"]),Object(n["createVNode"])(O,{onClick:function(e){return d.doUnSubscribe(t)},size:"small"},{default:Object(n["withCtx"])((function(){return[u]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:1},8,["data-source"])]})),_:1})]})),_:1})]})),_:1}),Object(n["createVNode"])(C,{title:"发布",shadow:"always",style:{"margin-bottom":"30px"}},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(m,{ref:"publish","hide-required-asterisk":"",size:"small","label-position":"top",model:c.publish},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(h,{gutter:24},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{span:16},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"主题"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(p,{value:c.publish.topic,"onUpdate:value":t[7]||(t[7]=function(e){return c.publish.topic=e})},null,8,["value"])]})),_:1})]})),_:1}),Object(n["createVNode"])(j,{span:8},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"QoS"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(v,{value:c.publish.qos,"onUpdate:value":t[8]||(t[8]=function(e){return c.publish.qos=e})},{default:Object(n["withCtx"])((function(){return[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(b.qosList,(function(e,t){return Object(n["openBlock"])(),Object(n["createBlock"])(w,{key:t,value:e.value},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.label),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value"])]})),_:1})]})),_:1})]})),_:1}),Object(n["createVNode"])(h,null,{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{span:16},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(f,{label:"消息"},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(_,{value:c.publish.payload,"onUpdate:value":t[9]||(t[9]=function(e){return c.publish.payload=e}),placeholder:"Basic usage",rows:4},null,8,["value"])]})),_:1})]})),_:1})]})),_:1})]})),_:1},8,["model"]),Object(n["createVNode"])(j,{span:24},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(O,{disabled:!b.connected,type:"success",size:"small",class:"publish-btn",onClick:d.doPublish},{default:Object(n["withCtx"])((function(){return[l]})),_:1},8,["disabled","onClick"])]})),_:1})]})),_:1}),Object(n["createVNode"])(C,{title:"接收消息",shadow:"always",style:{"margin-bottom":"30px"}},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(j,{span:24},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(g,{"item-layout":"horizontal","data-source":b.receiveMsg},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(x,{slot:"renderItem","slot-scope":"item, index"},{default:Object(n["withCtx"])((function(){return[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.item),1)]})),_:1})]})),_:1},8,["data-source"]),Object(n["createVNode"])(g,{"item-layout":"horizontal","data-source":b.receiveMsg},{renderItem:Object(n["withCtx"])((function(e){var t=e.item;return[Object(n["createVNode"])(x,null,{default:Object(n["withCtx"])((function(){return["publish"===t.type?(Object(n["openBlock"])(),Object(n["createBlock"])(V,{key:0,description:t.topic},{title:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",null,Object(n["toDisplayString"])(t.payload),1)]})),avatar:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(N,{src:"http://image.makerknz.cn/image/P_round_solid_p_by_climei.png"})]})),_:2},1032,["description"])):Object(n["createCommentVNode"])("",!0),"subscribe"===t.type?(Object(n["openBlock"])(),Object(n["createBlock"])(V,{key:1,description:t.topic},{avatar:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(N,{src:"http://image.makerknz.cn:9000/image/S_round_solid_s_by_climei.png"})]})),title:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",null,Object(n["toDisplayString"])(t.payload),1)]})),_:2},1032,["description"])):Object(n["createCommentVNode"])("",!0)]})),_:2},1024)]})),_:1},8,["data-source"])]})),_:1})]})),_:1})])}var b=c("3fe5"),d=(c("d994"),c("7e5a"),c("7223"),c("882b"),c("373e"),c("b2d6")),p=c.n(d),f=["host","port","endpoint"],j={name:"MqttClient",props:{connectionMess:{type:Object,default:function(){return{host:"mqtt.makerknz.cn",port:8083,endpoint:"/mqtt",clean:!0,connectTimeout:4e3,reconnectPeriod:4e3,clientId:"e443ec31b8db42b6882c0d0cf1600e7a",username:"emqx",password:"123456"}}},subscription:{type:Object,default:function(){return{topic:"topic/mqttx",qos:0}}},publish:{type:Object,default:function(){return{topic:"topic/browser",qos:0,payload:'{ "msg": "Hello, I am browser." }'}}}},data:function(){return{receiveMsg:[],qosList:[{label:0,value:0},{label:1,value:1},{label:2,value:2}],client:{connected:!1},subscripTopics:[],connected:!1,connectedLoading:!1,subscribeSuccess:!1}},methods:{createConnection:function(){var e=this,t=this.connectionMess,c=t.host,n=t.port,o=t.endpoint,r=Object(b["a"])(t,f),i="ws://".concat(c,":").concat(n).concat(o);this.connectedLoading=!0;try{this.client=p.a.connect(i,r)}catch(a){this.connectedLoading=!1,console.log("mqtt.connect error",a)}this.client.on("connect",(function(){e.client.connected=!0,e.connected=!0,e.connectedLoading=!1,console.log("Connection succeeded!")})),this.client.on("error",(function(t){e.$message.error(t.toString()),"Error: Connection refused: Not authorized"===t.toString()&&(e.client.end(),e.connectedLoading=!1),console.log("Connection failed",t)})),this.client.on("message",(function(t,c){e.connectedLoading=!1;var n={type:"subscribe"};n.topic=t,n.qos=0,n.payload=c,e.receiveMsg.push(n),console.log("Received message ".concat(c," from topic ").concat(t))})),this.client.stream.on("error",(function(t){e.connectedLoading&&(e.$message.error("连接错误，检查主机"),e.connectedLoading=!1),console.log("error",t),e.client.end()}))},doSubscribe:function(){var e=this,t=this.subscription,c=t.topic,n=t.qos;console.log(this.subscription),this.client.subscribe(c,{qos:n},(function(t,o){if(console.log("Subscribe to topics error",t),t)return e.$message.error("订阅错误:"+t.toString()),void console.log("Subscribe to topics error",t);if(o.length>0&&128===o[0].qos)e.$message.error("订阅权限错误");else{e.subscribeSuccess=!0;var r={topic:c,qos:n},i=!1;e.subscripTopics.forEach((function(t,n){t.topic===c&&(e.$message.warning("主题已经订阅"),i=!0)})),i||(e.subscripTopics.push(r),e.$message.success("订阅成功:"+o),console.log("Subscribe to topics res",o))}}))},doUnSubscribe:function(e){var t=this;this.client.unsubscribe(e.topic,(function(c){if(c)return t.$message.error("取消订阅错误:"+c.toString()),void console.log("Unsubscribe error",c);t.subscripTopics.forEach((function(c,n){c.topic===e.topic&&t.subscripTopics.splice(n,1)})),t.$message.success("取消订阅成功")}))},doPublish:function(){var e=this,t=this.publish,c=t.topic,n=t.qos,o=t.payload;this.client.publish(c,o,{qos:n,retain:!1},(function(t){t?console.log("Publish error",t):(console.log("Published"),e.publish.type="publish",e.receiveMsg.push(e.publish))}))},destroyConnection:function(){if(this.client.connected)try{this.client.end(),this.connected=!1,console.log("Successfully disconnected!")}catch(e){console.log("Disconnect failed",e.toString())}}}},O=(c("1fff"),c("b3f2")),h=c.n(O);const m=h()(j,[["render",s]]);t["default"]=m},5:function(e,t){},d4ef:function(e,t,c){}}]);